<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Shuffling with constraints</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Shuffling with constraints</h1>



<div id="purpose-of-the-vignette" class="section level1">
<h1>Purpose of the vignette</h1>
<p>This example demonstrates that by using customized shuffling
functions, it is possible to restrain the design optimization to only
score sample arrangements that fit the given constraints.</p>
<p>Key idea is that every reshuffling produces a ‘valid’ sample
permutation that is not violating those constraints, even if the
suggested solution may be quite bad. During optimization, we pick the
best design solution from the possible ones by appropriate scoring.</p>
<p>The user is free to implement custom shuffling functions and pass
those to the optimizer. However, some knowledge is required regarding
the internal workings of the optimization and batch container setup.
Therefore the package provides a little generic constructor for
customized shufflings <strong>shuffle_grouped_data</strong> in which
certain types of constraints that relate to grouped samples may be
specified by the passed parameters.</p>
</div>
<div id="the-design-problem" class="section level1">
<h1>The design problem</h1>
<div id="samples-and-treatments" class="section level2">
<h2>Samples and treatments</h2>
<p>We refer to a simplified version of the <em>in vivo</em> example
which is examined deeper in a dedicated vignette.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;invivo_study_samples&quot;</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>invivo_study_samples <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(invivo_study_samples,</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  <span class="at">Litter_combine_females =</span> <span class="fu">ifelse</span>(Sex <span class="sc">==</span> <span class="st">&quot;F&quot;</span>, <span class="st">&quot;female_all&quot;</span>, Litter)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">str</span>(invivo_study_samples)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co">#&gt; &#39;data.frame&#39;:    59 obs. of  9 variables:</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co">#&gt;  $ AnimalID              : chr  &quot;F1&quot; &quot;F2&quot; &quot;F3&quot; &quot;F4&quot; ...</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="co">#&gt;  $ Strain                : chr  &quot;Strain B&quot; &quot;Strain B&quot; &quot;Strain B&quot; &quot;Strain B&quot; ...</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co">#&gt;  $ Sex                   : chr  &quot;F&quot; &quot;F&quot; &quot;F&quot; &quot;F&quot; ...</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="co">#&gt;  $ BirthDate             : Date, format: &quot;2021-05-24&quot; &quot;2021-03-01&quot; ...</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="co">#&gt;  $ Earmark               : chr  &quot;R&quot; &quot;2L&quot; &quot;2L1R&quot; &quot;L&quot; ...</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="co">#&gt;  $ ArrivalWeight         : num  19.4 26.5 20.8 22.1 22.9 ...</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="co">#&gt;  $ Arrival.weight.Unit   : chr  &quot;g&quot; &quot;g&quot; &quot;g&quot; &quot;g&quot; ...</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="co">#&gt;  $ Litter                : chr  &quot;Litter 1&quot; &quot;Litter 2&quot; &quot;Litter 2&quot; &quot;Litter 2&quot; ...</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a><span class="co">#&gt;  $ Litter_combine_females: chr  &quot;female_all&quot; &quot;female_all&quot; &quot;female_all&quot; &quot;female_all&quot; ...</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>invivo_study_samples <span class="sc">|&gt;</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(Strain, Sex, Litter_combine_females) <span class="sc">|&gt;</span></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">gt</span>()</span></code></pre></div>
<div id="fvyclqskqw" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#fvyclqskqw table {
font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;
}
#fvyclqskqw thead, #fvyclqskqw tbody, #fvyclqskqw tfoot, #fvyclqskqw tr, #fvyclqskqw td, #fvyclqskqw th {
border-style: none;
}
#fvyclqskqw p {
margin: 0;
padding: 0;
}
#fvyclqskqw .gt_table {
display: table;
border-collapse: collapse;
line-height: normal;
margin-left: auto;
margin-right: auto;
color: #333333;
font-size: 16px;
font-weight: normal;
font-style: normal;
background-color: #FFFFFF;
width: auto;
border-top-style: solid;
border-top-width: 2px;
border-top-color: #A8A8A8;
border-right-style: none;
border-right-width: 2px;
border-right-color: #D3D3D3;
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #A8A8A8;
border-left-style: none;
border-left-width: 2px;
border-left-color: #D3D3D3;
}
#fvyclqskqw .gt_caption {
padding-top: 4px;
padding-bottom: 4px;
}
#fvyclqskqw .gt_title {
color: #333333;
font-size: 125%;
font-weight: initial;
padding-top: 4px;
padding-bottom: 4px;
padding-left: 5px;
padding-right: 5px;
border-bottom-color: #FFFFFF;
border-bottom-width: 0;
}
#fvyclqskqw .gt_subtitle {
color: #333333;
font-size: 85%;
font-weight: initial;
padding-top: 3px;
padding-bottom: 5px;
padding-left: 5px;
padding-right: 5px;
border-top-color: #FFFFFF;
border-top-width: 0;
}
#fvyclqskqw .gt_heading {
background-color: #FFFFFF;
text-align: center;
border-bottom-color: #FFFFFF;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
}
#fvyclqskqw .gt_bottom_border {
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
}
#fvyclqskqw .gt_col_headings {
border-top-style: solid;
border-top-width: 2px;
border-top-color: #D3D3D3;
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
}
#fvyclqskqw .gt_col_heading {
color: #333333;
background-color: #FFFFFF;
font-size: 100%;
font-weight: normal;
text-transform: inherit;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
vertical-align: bottom;
padding-top: 5px;
padding-bottom: 6px;
padding-left: 5px;
padding-right: 5px;
overflow-x: hidden;
}
#fvyclqskqw .gt_column_spanner_outer {
color: #333333;
background-color: #FFFFFF;
font-size: 100%;
font-weight: normal;
text-transform: inherit;
padding-top: 0;
padding-bottom: 0;
padding-left: 4px;
padding-right: 4px;
}
#fvyclqskqw .gt_column_spanner_outer:first-child {
padding-left: 0;
}
#fvyclqskqw .gt_column_spanner_outer:last-child {
padding-right: 0;
}
#fvyclqskqw .gt_column_spanner {
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
vertical-align: bottom;
padding-top: 5px;
padding-bottom: 5px;
overflow-x: hidden;
display: inline-block;
width: 100%;
}
#fvyclqskqw .gt_spanner_row {
border-bottom-style: hidden;
}
#fvyclqskqw .gt_group_heading {
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
color: #333333;
background-color: #FFFFFF;
font-size: 100%;
font-weight: initial;
text-transform: inherit;
border-top-style: solid;
border-top-width: 2px;
border-top-color: #D3D3D3;
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
vertical-align: middle;
text-align: left;
}
#fvyclqskqw .gt_empty_group_heading {
padding: 0.5px;
color: #333333;
background-color: #FFFFFF;
font-size: 100%;
font-weight: initial;
border-top-style: solid;
border-top-width: 2px;
border-top-color: #D3D3D3;
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
vertical-align: middle;
}
#fvyclqskqw .gt_from_md > :first-child {
margin-top: 0;
}
#fvyclqskqw .gt_from_md > :last-child {
margin-bottom: 0;
}
#fvyclqskqw .gt_row {
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
margin: 10px;
border-top-style: solid;
border-top-width: 1px;
border-top-color: #D3D3D3;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
vertical-align: middle;
overflow-x: hidden;
}
#fvyclqskqw .gt_stub {
color: #333333;
background-color: #FFFFFF;
font-size: 100%;
font-weight: initial;
text-transform: inherit;
border-right-style: solid;
border-right-width: 2px;
border-right-color: #D3D3D3;
padding-left: 5px;
padding-right: 5px;
}
#fvyclqskqw .gt_stub_row_group {
color: #333333;
background-color: #FFFFFF;
font-size: 100%;
font-weight: initial;
text-transform: inherit;
border-right-style: solid;
border-right-width: 2px;
border-right-color: #D3D3D3;
padding-left: 5px;
padding-right: 5px;
vertical-align: top;
}
#fvyclqskqw .gt_row_group_first td {
border-top-width: 2px;
}
#fvyclqskqw .gt_row_group_first th {
border-top-width: 2px;
}
#fvyclqskqw .gt_summary_row {
color: #333333;
background-color: #FFFFFF;
text-transform: inherit;
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
}
#fvyclqskqw .gt_first_summary_row {
border-top-style: solid;
border-top-color: #D3D3D3;
}
#fvyclqskqw .gt_first_summary_row.thick {
border-top-width: 2px;
}
#fvyclqskqw .gt_last_summary_row {
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
}
#fvyclqskqw .gt_grand_summary_row {
color: #333333;
background-color: #FFFFFF;
text-transform: inherit;
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
}
#fvyclqskqw .gt_first_grand_summary_row {
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
border-top-style: double;
border-top-width: 6px;
border-top-color: #D3D3D3;
}
#fvyclqskqw .gt_last_grand_summary_row_top {
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
border-bottom-style: double;
border-bottom-width: 6px;
border-bottom-color: #D3D3D3;
}
#fvyclqskqw .gt_striped {
background-color: rgba(128, 128, 128, 0.05);
}
#fvyclqskqw .gt_table_body {
border-top-style: solid;
border-top-width: 2px;
border-top-color: #D3D3D3;
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
}
#fvyclqskqw .gt_footnotes {
color: #333333;
background-color: #FFFFFF;
border-bottom-style: none;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
border-left-style: none;
border-left-width: 2px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 2px;
border-right-color: #D3D3D3;
}
#fvyclqskqw .gt_footnote {
margin: 0px;
font-size: 90%;
padding-top: 4px;
padding-bottom: 4px;
padding-left: 5px;
padding-right: 5px;
}
#fvyclqskqw .gt_sourcenotes {
color: #333333;
background-color: #FFFFFF;
border-bottom-style: none;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
border-left-style: none;
border-left-width: 2px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 2px;
border-right-color: #D3D3D3;
}
#fvyclqskqw .gt_sourcenote {
font-size: 90%;
padding-top: 4px;
padding-bottom: 4px;
padding-left: 5px;
padding-right: 5px;
}
#fvyclqskqw .gt_left {
text-align: left;
}
#fvyclqskqw .gt_center {
text-align: center;
}
#fvyclqskqw .gt_right {
text-align: right;
font-variant-numeric: tabular-nums;
}
#fvyclqskqw .gt_font_normal {
font-weight: normal;
}
#fvyclqskqw .gt_font_bold {
font-weight: bold;
}
#fvyclqskqw .gt_font_italic {
font-style: italic;
}
#fvyclqskqw .gt_super {
font-size: 65%;
}
#fvyclqskqw .gt_footnote_marks {
font-size: 75%;
vertical-align: 0.4em;
position: initial;
}
#fvyclqskqw .gt_asterisk {
font-size: 100%;
vertical-align: 0;
}
#fvyclqskqw .gt_indent_1 {
text-indent: 5px;
}
#fvyclqskqw .gt_indent_2 {
text-indent: 10px;
}
#fvyclqskqw .gt_indent_3 {
text-indent: 15px;
}
#fvyclqskqw .gt_indent_4 {
text-indent: 20px;
}
#fvyclqskqw .gt_indent_5 {
text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Strain">Strain</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Sex">Sex</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Litter_combine_females">Litter_combine_females</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="n">n</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="Strain" class="gt_row gt_left">Strain A</td>
<td headers="Sex" class="gt_row gt_left">F</td>
<td headers="Litter_combine_females" class="gt_row gt_left">female_all</td>
<td headers="n" class="gt_row gt_right">7</td></tr>
    <tr><td headers="Strain" class="gt_row gt_left">Strain A</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Litter_combine_females" class="gt_row gt_left">Litter 10</td>
<td headers="n" class="gt_row gt_right">3</td></tr>
    <tr><td headers="Strain" class="gt_row gt_left">Strain A</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Litter_combine_females" class="gt_row gt_left">Litter 11</td>
<td headers="n" class="gt_row gt_right">4</td></tr>
    <tr><td headers="Strain" class="gt_row gt_left">Strain A</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Litter_combine_females" class="gt_row gt_left">Litter 12</td>
<td headers="n" class="gt_row gt_right">5</td></tr>
    <tr><td headers="Strain" class="gt_row gt_left">Strain A</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Litter_combine_females" class="gt_row gt_left">Litter 13</td>
<td headers="n" class="gt_row gt_right">4</td></tr>
    <tr><td headers="Strain" class="gt_row gt_left">Strain A</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Litter_combine_females" class="gt_row gt_left">Litter 14</td>
<td headers="n" class="gt_row gt_right">6</td></tr>
    <tr><td headers="Strain" class="gt_row gt_left">Strain B</td>
<td headers="Sex" class="gt_row gt_left">F</td>
<td headers="Litter_combine_females" class="gt_row gt_left">female_all</td>
<td headers="n" class="gt_row gt_right">7</td></tr>
    <tr><td headers="Strain" class="gt_row gt_left">Strain B</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Litter_combine_females" class="gt_row gt_left">Litter 1</td>
<td headers="n" class="gt_row gt_right">3</td></tr>
    <tr><td headers="Strain" class="gt_row gt_left">Strain B</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Litter_combine_females" class="gt_row gt_left">Litter 3</td>
<td headers="n" class="gt_row gt_right">5</td></tr>
    <tr><td headers="Strain" class="gt_row gt_left">Strain B</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Litter_combine_females" class="gt_row gt_left">Litter 4</td>
<td headers="n" class="gt_row gt_right">4</td></tr>
    <tr><td headers="Strain" class="gt_row gt_left">Strain B</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Litter_combine_females" class="gt_row gt_left">Litter 5</td>
<td headers="n" class="gt_row gt_right">4</td></tr>
    <tr><td headers="Strain" class="gt_row gt_left">Strain B</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Litter_combine_females" class="gt_row gt_left">Litter 6</td>
<td headers="n" class="gt_row gt_right">4</td></tr>
    <tr><td headers="Strain" class="gt_row gt_left">Strain B</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Litter_combine_females" class="gt_row gt_left">Litter 7</td>
<td headers="n" class="gt_row gt_right">3</td></tr>
  </tbody>
  
  
</table>
</div>
<p>We will use the litter as a factor to form cages in our design.
However, in order to indicate the compatibility of female animals (see
<em>in vivo</em> study vignette), a pseudo-litter
<code>female_all</code> is created here to group all the females
together, marking them as interchangeable for the subgroup (i.e. cage)
allocation.</p>
<p>In the simplified setup we want to assign two treatments to those
animals, balancing for strain and sex as the primary suspected
confounders. The batch container is prepared as follows:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>treatments <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Treatment A&quot;</span>, <span class="st">&quot;Treatment B&quot;</span>), <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">29</span>)))</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">table</span>(treatments)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co">#&gt; treatments</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#&gt; Treatment A Treatment B </span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">#&gt;          30          29</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>bc <span class="ot">&lt;-</span> BatchContainer<span class="sc">$</span><span class="fu">new</span>(<span class="at">locations_table =</span> <span class="fu">data.frame</span>(<span class="at">Treatment =</span> treatments, <span class="at">Position =</span> <span class="fu">seq_along</span>(treatments)))</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>bc <span class="ot">&lt;-</span> <span class="fu">assign_in_order</span>(bc, invivo_study_samples)</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>scoring_f <span class="ot">&lt;-</span> <span class="fu">osat_score_generator</span>(<span class="at">batch_vars =</span> <span class="st">&quot;Treatment&quot;</span>, <span class="at">feature_vars =</span> <span class="fu">c</span>(<span class="st">&quot;Strain&quot;</span>, <span class="st">&quot;Sex&quot;</span>))</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>bc</span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="co">#&gt; Batch container with 59 locations and 59 samples (assigned).</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="co">#&gt;   Dimensions: Treatment, Position</span></span></code></pre></div>
</div>
<div id="subgroup-related-constraints" class="section level2">
<h2>Subgroup related constraints</h2>
<p>As noted, we have to assign animals to cages in this example. The
cage is thus acting as the grouping factor for the samples (animals) on
which we may want to put further constraints. Concretely:</p>
<ul>
<li>We want to form cages with ideally 3 animals each
(tolerated/preferred range is from 2-5)</li>
<li>Variables Strain, Sex and Treatment must be homogeneous within
cage</li>
<li>Animals of different litters must not be put into the same cage</li>
<li>If at all possible, avoid putting animals with the same ear markings
into one cage</li>
</ul>
<p>We will tackle the usual factor balancing (using the osat score) and
the additional constraints at the same time, combined in one
conceptional framework.</p>
<p>As stated, the main idea is to provide a customized shuffling
function that ensures that only ‘suitable’ design proposals are
generated and passed to the scoring function which will then identify a
good one.</p>
<p>Also keep in mind that what is the cage here could be any subgroup
into which samples have to be partitioned.</p>
</div>
</div>
<div id="doing-it-all-in-one-go" class="section level1">
<h1>Doing it all in one go</h1>
<p>The wrapper <code>shuffle_grouped_data</code> allows to construct a
shuffling function that satisfies all constraints defined above at the
same time. It can be passed to the optimizer together with other user
defined options such as the scoring or acceptance functions.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>bc2 <span class="ot">&lt;-</span> <span class="fu">optimize_design</span>(</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  bc,</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  <span class="at">scoring =</span> scoring_f,</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  <span class="at">shuffle_proposal_func =</span> <span class="fu">shuffle_grouped_data</span>(bc,</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>    <span class="at">allocate_var =</span> <span class="st">&quot;Treatment&quot;</span>,</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>    <span class="at">keep_together_vars =</span> <span class="fu">c</span>(<span class="st">&quot;Strain&quot;</span>, <span class="st">&quot;Sex&quot;</span>),</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>    <span class="at">keep_separate_vars =</span> <span class="fu">c</span>(<span class="st">&quot;Earmark&quot;</span>),</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>    <span class="at">subgroup_var_name =</span> <span class="st">&quot;Cage&quot;</span>,</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>    <span class="at">n_min =</span> <span class="dv">2</span>, <span class="at">n_ideal =</span> <span class="dv">3</span>, <span class="at">n_max =</span> <span class="dv">5</span>,</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>    <span class="at">strict =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>    <span class="at">report_grouping_as_attribute =</span> <span class="cn">TRUE</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>  ),</span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>  <span class="at">max_iter =</span> <span class="dv">600</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>)</span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="co">#&gt; Formed 4 homogeneous groups using 59 samples.</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a><span class="co">#&gt; 22 subgroups needed to satisfy size constraints.</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a><span class="co">#&gt; Finding possible ways to allocate variable of interest with 2 levels ...</span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a><span class="co">#&gt; Aborted after 1000010 recursive calls (maxCalls limit).</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a><span class="co">#&gt; 176364 allocations found.</span></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a><span class="co">#&gt; Usage of sample attributes --&gt; executing first shuffling call.</span></span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a><span class="co">#&gt; Checking variances of 1-dim. score vector.</span></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a><span class="co">#&gt; ... (234.938) - OK</span></span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a><span class="co">#&gt; Initial score: 453.202</span></span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a><span class="co">#&gt; Adding 4 attributes to samples.</span></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a><span class="co">#&gt; Achieved score: 355.575 at iteration 2</span></span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a><span class="co">#&gt; No permutations fulfilling the &#39;keep_separate&#39; constraints in 1000 iters!</span></span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a><span class="co">#&gt; Increasing number of tolerated violations to 1</span></span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a><span class="co">#&gt; Achieved score: 305.134 at iteration 19</span></span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a><span class="co">#&gt; Achieved score: 272.592 at iteration 20</span></span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a><span class="co">#&gt; Achieved score: 231.507 at iteration 34</span></span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a><span class="co">#&gt; Achieved score: 181.473 at iteration 52</span></span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a><span class="co">#&gt; Achieved score: 143.032 at iteration 116</span></span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a><span class="co">#&gt; Achieved score: 122.49 at iteration 123</span></span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a><span class="co">#&gt; Achieved score: 105.405 at iteration 165</span></span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a><span class="co">#&gt; Achieved score: 104.999 at iteration 356</span></span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a><span class="co">#&gt; Achieved score: 79.371 at iteration 384</span></span>
<span id="cb3-40"><a href="#cb3-40" tabindex="-1"></a><span class="co">#&gt; Achieved score: 52.931 at iteration 525</span></span>
<span id="cb3-41"><a href="#cb3-41" tabindex="-1"></a><span class="co">#&gt; Achieved score: 44.388 at iteration 546</span></span>
<span id="cb3-42"><a href="#cb3-42" tabindex="-1"></a></span>
<span id="cb3-43"><a href="#cb3-43" tabindex="-1"></a>design <span class="ot">&lt;-</span> bc2<span class="sc">$</span><span class="fu">get_samples</span>()</span></code></pre></div>
<p><code>allocate_var</code> is the batch container variable that should
be primarily assigned to individual samples.</p>
<p><code>keep_together_vars</code> is a list of variables that must be
homogeneous within a subgroup (here: cage).</p>
<p><code>keep_separate_vars</code> lists variables which should have
different values within a subgroup (here: cage), if at all possible.
This is a soft constraint and will be relaxed in a stepwise way until
solutions can be found.</p>
<p><code>subgroup_var_name</code> allows to give the generated subgroup
variable a useful name.</p>
<p><code>n_min</code>, <code>n_max</code> and <code>n_ideal</code>
specify the minimal, maximal and ideal group sizes, respectively. It is
often necessary to release the <code>strict</code> criterion to find any
solution at all that satisfies those size criteria.</p>
<p><code>report_grouping_as_attribute</code> allows, if TRUE, to add the
updated group variable into the batch container at each iteration, so
that scoring functions could make use of this variable (here: cage)!</p>
<p>Following the output of the optimizer, we see that a solution was
identified that satisfies all constraints, with the exception of
tolerating one violation of earmark-uniqueness within a cage.</p>
<p>The following cages (homogeneous in strain, sex and treatment) have
been generated in the process:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>design <span class="sc">|&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(Cage, Strain, Sex, Treatment) <span class="sc">|&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">gt</span>()</span></code></pre></div>
<div id="yavrfgpspz" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#yavrfgpspz table {
font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;
}
#yavrfgpspz thead, #yavrfgpspz tbody, #yavrfgpspz tfoot, #yavrfgpspz tr, #yavrfgpspz td, #yavrfgpspz th {
border-style: none;
}
#yavrfgpspz p {
margin: 0;
padding: 0;
}
#yavrfgpspz .gt_table {
display: table;
border-collapse: collapse;
line-height: normal;
margin-left: auto;
margin-right: auto;
color: #333333;
font-size: 16px;
font-weight: normal;
font-style: normal;
background-color: #FFFFFF;
width: auto;
border-top-style: solid;
border-top-width: 2px;
border-top-color: #A8A8A8;
border-right-style: none;
border-right-width: 2px;
border-right-color: #D3D3D3;
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #A8A8A8;
border-left-style: none;
border-left-width: 2px;
border-left-color: #D3D3D3;
}
#yavrfgpspz .gt_caption {
padding-top: 4px;
padding-bottom: 4px;
}
#yavrfgpspz .gt_title {
color: #333333;
font-size: 125%;
font-weight: initial;
padding-top: 4px;
padding-bottom: 4px;
padding-left: 5px;
padding-right: 5px;
border-bottom-color: #FFFFFF;
border-bottom-width: 0;
}
#yavrfgpspz .gt_subtitle {
color: #333333;
font-size: 85%;
font-weight: initial;
padding-top: 3px;
padding-bottom: 5px;
padding-left: 5px;
padding-right: 5px;
border-top-color: #FFFFFF;
border-top-width: 0;
}
#yavrfgpspz .gt_heading {
background-color: #FFFFFF;
text-align: center;
border-bottom-color: #FFFFFF;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
}
#yavrfgpspz .gt_bottom_border {
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
}
#yavrfgpspz .gt_col_headings {
border-top-style: solid;
border-top-width: 2px;
border-top-color: #D3D3D3;
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
}
#yavrfgpspz .gt_col_heading {
color: #333333;
background-color: #FFFFFF;
font-size: 100%;
font-weight: normal;
text-transform: inherit;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
vertical-align: bottom;
padding-top: 5px;
padding-bottom: 6px;
padding-left: 5px;
padding-right: 5px;
overflow-x: hidden;
}
#yavrfgpspz .gt_column_spanner_outer {
color: #333333;
background-color: #FFFFFF;
font-size: 100%;
font-weight: normal;
text-transform: inherit;
padding-top: 0;
padding-bottom: 0;
padding-left: 4px;
padding-right: 4px;
}
#yavrfgpspz .gt_column_spanner_outer:first-child {
padding-left: 0;
}
#yavrfgpspz .gt_column_spanner_outer:last-child {
padding-right: 0;
}
#yavrfgpspz .gt_column_spanner {
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
vertical-align: bottom;
padding-top: 5px;
padding-bottom: 5px;
overflow-x: hidden;
display: inline-block;
width: 100%;
}
#yavrfgpspz .gt_spanner_row {
border-bottom-style: hidden;
}
#yavrfgpspz .gt_group_heading {
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
color: #333333;
background-color: #FFFFFF;
font-size: 100%;
font-weight: initial;
text-transform: inherit;
border-top-style: solid;
border-top-width: 2px;
border-top-color: #D3D3D3;
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
vertical-align: middle;
text-align: left;
}
#yavrfgpspz .gt_empty_group_heading {
padding: 0.5px;
color: #333333;
background-color: #FFFFFF;
font-size: 100%;
font-weight: initial;
border-top-style: solid;
border-top-width: 2px;
border-top-color: #D3D3D3;
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
vertical-align: middle;
}
#yavrfgpspz .gt_from_md > :first-child {
margin-top: 0;
}
#yavrfgpspz .gt_from_md > :last-child {
margin-bottom: 0;
}
#yavrfgpspz .gt_row {
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
margin: 10px;
border-top-style: solid;
border-top-width: 1px;
border-top-color: #D3D3D3;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
vertical-align: middle;
overflow-x: hidden;
}
#yavrfgpspz .gt_stub {
color: #333333;
background-color: #FFFFFF;
font-size: 100%;
font-weight: initial;
text-transform: inherit;
border-right-style: solid;
border-right-width: 2px;
border-right-color: #D3D3D3;
padding-left: 5px;
padding-right: 5px;
}
#yavrfgpspz .gt_stub_row_group {
color: #333333;
background-color: #FFFFFF;
font-size: 100%;
font-weight: initial;
text-transform: inherit;
border-right-style: solid;
border-right-width: 2px;
border-right-color: #D3D3D3;
padding-left: 5px;
padding-right: 5px;
vertical-align: top;
}
#yavrfgpspz .gt_row_group_first td {
border-top-width: 2px;
}
#yavrfgpspz .gt_row_group_first th {
border-top-width: 2px;
}
#yavrfgpspz .gt_summary_row {
color: #333333;
background-color: #FFFFFF;
text-transform: inherit;
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
}
#yavrfgpspz .gt_first_summary_row {
border-top-style: solid;
border-top-color: #D3D3D3;
}
#yavrfgpspz .gt_first_summary_row.thick {
border-top-width: 2px;
}
#yavrfgpspz .gt_last_summary_row {
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
}
#yavrfgpspz .gt_grand_summary_row {
color: #333333;
background-color: #FFFFFF;
text-transform: inherit;
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
}
#yavrfgpspz .gt_first_grand_summary_row {
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
border-top-style: double;
border-top-width: 6px;
border-top-color: #D3D3D3;
}
#yavrfgpspz .gt_last_grand_summary_row_top {
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
border-bottom-style: double;
border-bottom-width: 6px;
border-bottom-color: #D3D3D3;
}
#yavrfgpspz .gt_striped {
background-color: rgba(128, 128, 128, 0.05);
}
#yavrfgpspz .gt_table_body {
border-top-style: solid;
border-top-width: 2px;
border-top-color: #D3D3D3;
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
}
#yavrfgpspz .gt_footnotes {
color: #333333;
background-color: #FFFFFF;
border-bottom-style: none;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
border-left-style: none;
border-left-width: 2px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 2px;
border-right-color: #D3D3D3;
}
#yavrfgpspz .gt_footnote {
margin: 0px;
font-size: 90%;
padding-top: 4px;
padding-bottom: 4px;
padding-left: 5px;
padding-right: 5px;
}
#yavrfgpspz .gt_sourcenotes {
color: #333333;
background-color: #FFFFFF;
border-bottom-style: none;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
border-left-style: none;
border-left-width: 2px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 2px;
border-right-color: #D3D3D3;
}
#yavrfgpspz .gt_sourcenote {
font-size: 90%;
padding-top: 4px;
padding-bottom: 4px;
padding-left: 5px;
padding-right: 5px;
}
#yavrfgpspz .gt_left {
text-align: left;
}
#yavrfgpspz .gt_center {
text-align: center;
}
#yavrfgpspz .gt_right {
text-align: right;
font-variant-numeric: tabular-nums;
}
#yavrfgpspz .gt_font_normal {
font-weight: normal;
}
#yavrfgpspz .gt_font_bold {
font-weight: bold;
}
#yavrfgpspz .gt_font_italic {
font-style: italic;
}
#yavrfgpspz .gt_super {
font-size: 65%;
}
#yavrfgpspz .gt_footnote_marks {
font-size: 75%;
vertical-align: 0.4em;
position: initial;
}
#yavrfgpspz .gt_asterisk {
font-size: 100%;
vertical-align: 0;
}
#yavrfgpspz .gt_indent_1 {
text-indent: 5px;
}
#yavrfgpspz .gt_indent_2 {
text-indent: 10px;
}
#yavrfgpspz .gt_indent_3 {
text-indent: 15px;
}
#yavrfgpspz .gt_indent_4 {
text-indent: 20px;
}
#yavrfgpspz .gt_indent_5 {
text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Cage">Cage</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Strain">Strain</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Sex">Sex</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Treatment">Treatment</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="n">n</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="Cage" class="gt_row gt_left">1_1</td>
<td headers="Strain" class="gt_row gt_left">Strain A</td>
<td headers="Sex" class="gt_row gt_left">F</td>
<td headers="Treatment" class="gt_row gt_center">Treatment A</td>
<td headers="n" class="gt_row gt_right">3</td></tr>
    <tr><td headers="Cage" class="gt_row gt_left">1_2</td>
<td headers="Strain" class="gt_row gt_left">Strain A</td>
<td headers="Sex" class="gt_row gt_left">F</td>
<td headers="Treatment" class="gt_row gt_center">Treatment A</td>
<td headers="n" class="gt_row gt_right">2</td></tr>
    <tr><td headers="Cage" class="gt_row gt_left">1_3</td>
<td headers="Strain" class="gt_row gt_left">Strain A</td>
<td headers="Sex" class="gt_row gt_left">F</td>
<td headers="Treatment" class="gt_row gt_center">Treatment A</td>
<td headers="n" class="gt_row gt_right">2</td></tr>
    <tr><td headers="Cage" class="gt_row gt_left">2_1</td>
<td headers="Strain" class="gt_row gt_left">Strain A</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Treatment" class="gt_row gt_center">Treatment A</td>
<td headers="n" class="gt_row gt_right">3</td></tr>
    <tr><td headers="Cage" class="gt_row gt_left">2_2</td>
<td headers="Strain" class="gt_row gt_left">Strain A</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Treatment" class="gt_row gt_center">Treatment A</td>
<td headers="n" class="gt_row gt_right">3</td></tr>
    <tr><td headers="Cage" class="gt_row gt_left">2_3</td>
<td headers="Strain" class="gt_row gt_left">Strain A</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Treatment" class="gt_row gt_center">Treatment A</td>
<td headers="n" class="gt_row gt_right">3</td></tr>
    <tr><td headers="Cage" class="gt_row gt_left">2_4</td>
<td headers="Strain" class="gt_row gt_left">Strain A</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Treatment" class="gt_row gt_center">Treatment A</td>
<td headers="n" class="gt_row gt_right">3</td></tr>
    <tr><td headers="Cage" class="gt_row gt_left">2_5</td>
<td headers="Strain" class="gt_row gt_left">Strain A</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Treatment" class="gt_row gt_center">Treatment B</td>
<td headers="n" class="gt_row gt_right">3</td></tr>
    <tr><td headers="Cage" class="gt_row gt_left">2_6</td>
<td headers="Strain" class="gt_row gt_left">Strain A</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Treatment" class="gt_row gt_center">Treatment B</td>
<td headers="n" class="gt_row gt_right">3</td></tr>
    <tr><td headers="Cage" class="gt_row gt_left">2_7</td>
<td headers="Strain" class="gt_row gt_left">Strain A</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Treatment" class="gt_row gt_center">Treatment B</td>
<td headers="n" class="gt_row gt_right">2</td></tr>
    <tr><td headers="Cage" class="gt_row gt_left">2_8</td>
<td headers="Strain" class="gt_row gt_left">Strain A</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Treatment" class="gt_row gt_center">Treatment B</td>
<td headers="n" class="gt_row gt_right">2</td></tr>
    <tr><td headers="Cage" class="gt_row gt_left">3_1</td>
<td headers="Strain" class="gt_row gt_left">Strain B</td>
<td headers="Sex" class="gt_row gt_left">F</td>
<td headers="Treatment" class="gt_row gt_center">Treatment B</td>
<td headers="n" class="gt_row gt_right">3</td></tr>
    <tr><td headers="Cage" class="gt_row gt_left">3_2</td>
<td headers="Strain" class="gt_row gt_left">Strain B</td>
<td headers="Sex" class="gt_row gt_left">F</td>
<td headers="Treatment" class="gt_row gt_center">Treatment A</td>
<td headers="n" class="gt_row gt_right">2</td></tr>
    <tr><td headers="Cage" class="gt_row gt_left">3_3</td>
<td headers="Strain" class="gt_row gt_left">Strain B</td>
<td headers="Sex" class="gt_row gt_left">F</td>
<td headers="Treatment" class="gt_row gt_center">Treatment B</td>
<td headers="n" class="gt_row gt_right">2</td></tr>
    <tr><td headers="Cage" class="gt_row gt_left">4_1</td>
<td headers="Strain" class="gt_row gt_left">Strain B</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Treatment" class="gt_row gt_center">Treatment A</td>
<td headers="n" class="gt_row gt_right">3</td></tr>
    <tr><td headers="Cage" class="gt_row gt_left">4_2</td>
<td headers="Strain" class="gt_row gt_left">Strain B</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Treatment" class="gt_row gt_center">Treatment A</td>
<td headers="n" class="gt_row gt_right">3</td></tr>
    <tr><td headers="Cage" class="gt_row gt_left">4_3</td>
<td headers="Strain" class="gt_row gt_left">Strain B</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Treatment" class="gt_row gt_center">Treatment A</td>
<td headers="n" class="gt_row gt_right">3</td></tr>
    <tr><td headers="Cage" class="gt_row gt_left">4_4</td>
<td headers="Strain" class="gt_row gt_left">Strain B</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Treatment" class="gt_row gt_center">Treatment B</td>
<td headers="n" class="gt_row gt_right">3</td></tr>
    <tr><td headers="Cage" class="gt_row gt_left">4_5</td>
<td headers="Strain" class="gt_row gt_left">Strain B</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Treatment" class="gt_row gt_center">Treatment B</td>
<td headers="n" class="gt_row gt_right">3</td></tr>
    <tr><td headers="Cage" class="gt_row gt_left">4_6</td>
<td headers="Strain" class="gt_row gt_left">Strain B</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Treatment" class="gt_row gt_center">Treatment B</td>
<td headers="n" class="gt_row gt_right">3</td></tr>
    <tr><td headers="Cage" class="gt_row gt_left">4_7</td>
<td headers="Strain" class="gt_row gt_left">Strain B</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Treatment" class="gt_row gt_center">Treatment B</td>
<td headers="n" class="gt_row gt_right">3</td></tr>
    <tr><td headers="Cage" class="gt_row gt_left">4_8</td>
<td headers="Strain" class="gt_row gt_left">Strain B</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Treatment" class="gt_row gt_center">Treatment B</td>
<td headers="n" class="gt_row gt_right">2</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
<div id="multiple-step-approach" class="section level1">
<h1>Multiple step approach</h1>
<p><code>shuffle_grouped_data</code> is a wrapper that consecutively
calls other helper function. As an addendum, let us break the whole
procedure down into parts that show what is happening internally at each
step.</p>
<div id="form-homogeneous-subgroups---pools-of-animals-that-could-go-into-one-cage" class="section level2">
<h2>Form homogeneous subgroups - pools of animals that could go into one
cage</h2>
<p>We have to divide our animal cohort into subgroups with same strain
and sex, meeting size constraints as stated above. Since 2-5 animals
should go into one cage, we specify <code>n_min</code>and
<code>n_max</code>accordingly. <code>n_ideal</code> would be selected by
default as the mean of those two, but we specify it explicitly here,
too.</p>
<p>The homogeneity of subgroups regarding strain and sex is achieved by
listing those two parameters as <code>keep_together_vars</code>.</p>
<p>Assignment of treatments should be performed as well at some point.
We thus specify Treatment as the <code>allocation variable</code>.</p>
<p>Note that the <code>Treatment</code> variable is technically a batch
container location and not a part of the sample list. This distinction
does not matter at this point. However, all required variables must
exist in the batch container object.</p>
<p>The following call to <code>form_homogeneous_subgroups()</code>
produces an object that holds all relevant information about the
samples, the allocation variable and the sizes of the subgroups that
have to be formed. It is NOT decided, however, which animal will end up
in which subgroup. This will be a matter of optimization later on.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>subg <span class="ot">&lt;-</span> <span class="fu">form_homogeneous_subgroups</span>(</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  <span class="at">batch_container =</span> bc, <span class="at">allocate_var =</span> <span class="st">&quot;Treatment&quot;</span>,</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  <span class="at">keep_together_vars =</span> <span class="fu">c</span>(<span class="st">&quot;Strain&quot;</span>, <span class="st">&quot;Sex&quot;</span>, <span class="st">&quot;Litter_combine_females&quot;</span>),</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  <span class="at">subgroup_var_name =</span> <span class="st">&quot;Cage&quot;</span>,</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  <span class="at">n_min =</span> <span class="dv">2</span>, <span class="at">n_ideal =</span> <span class="dv">3</span>, <span class="at">n_max =</span> <span class="dv">5</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>)</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co">#&gt; Formed 13 homogeneous groups using 59 samples.</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">#&gt; 18 subgroups needed to satisfy size constraints.</span></span></code></pre></div>
<p>In this example, 18 subgroups have to be formed to meet all
constraints.</p>
<p>It is possible to obtain more information from the returned list
object. Inspection of element <code>Subgroup_Sizes</code> tells us that
13 ‘animal pools’ have to be formed which are homogeneous in the
relevant parameters (here: strain and sex). Each of those groups happens
to be split in subgroups with a size between 2 and 4 animals , which
will later constitute the individual cages.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>subg<span class="sc">$</span>Subgroup_Sizes</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="co">#&gt; $`Strain A/F/female_all`</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co">#&gt; [1] 3 4</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co">#&gt; $`Strain A/M/Litter 10`</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co">#&gt; [1] 3</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co">#&gt; $`Strain A/M/Litter 11`</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co">#&gt; [1] 4</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co">#&gt; $`Strain A/M/Litter 12`</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">#&gt; [1] 3 2</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">#&gt; $`Strain A/M/Litter 13`</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="co">#&gt; [1] 4</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a><span class="co">#&gt; $`Strain A/M/Litter 14`</span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a><span class="co">#&gt; [1] 3 3</span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a><span class="co">#&gt; $`Strain B/F/female_all`</span></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a><span class="co">#&gt; [1] 3 4</span></span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a><span class="co">#&gt; $`Strain B/M/Litter 1`</span></span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a><span class="co">#&gt; [1] 3</span></span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a><span class="co">#&gt; $`Strain B/M/Litter 3`</span></span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a><span class="co">#&gt; [1] 3 2</span></span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-29"><a href="#cb6-29" tabindex="-1"></a><span class="co">#&gt; $`Strain B/M/Litter 4`</span></span>
<span id="cb6-30"><a href="#cb6-30" tabindex="-1"></a><span class="co">#&gt; [1] 4</span></span>
<span id="cb6-31"><a href="#cb6-31" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-32"><a href="#cb6-32" tabindex="-1"></a><span class="co">#&gt; $`Strain B/M/Litter 5`</span></span>
<span id="cb6-33"><a href="#cb6-33" tabindex="-1"></a><span class="co">#&gt; [1] 4</span></span>
<span id="cb6-34"><a href="#cb6-34" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-35"><a href="#cb6-35" tabindex="-1"></a><span class="co">#&gt; $`Strain B/M/Litter 6`</span></span>
<span id="cb6-36"><a href="#cb6-36" tabindex="-1"></a><span class="co">#&gt; [1] 4</span></span>
<span id="cb6-37"><a href="#cb6-37" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-38"><a href="#cb6-38" tabindex="-1"></a><span class="co">#&gt; $`Strain B/M/Litter 7`</span></span>
<span id="cb6-39"><a href="#cb6-39" tabindex="-1"></a><span class="co">#&gt; [1] 3</span></span></code></pre></div>
</div>
<div id="find-all-valid-ways-to-allocate-treatments-to-the-subgroups" class="section level2">
<h2>Find all valid ways to allocate treatments to the subgroups</h2>
<p>Each subgroup of animals receives one specific treatment. Or more
generally: subgroups have to be homogeneous regarding the allocation
variable.</p>
<p>This introduces another type of constraint, since numbers have to add
up to 10 ‘Control’ and 10 ‘Compound’ cases, as given by the
<code>treatments</code> variable. As a next step, we have to find all
possible combinations of subgroups which produce valid options for the
treatment allocation. That’s done with the next call.</p>
<p>This will find a large number of different ways to assign treatments
to subgroups that lead to the correct overall number of treated
animals.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>possible <span class="ot">&lt;-</span> <span class="fu">compile_possible_subgroup_allocation</span>(subg)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co">#&gt; Finding possible ways to allocate variable of interest with 2 levels ...</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">#&gt; Finished with 108296 recursive calls.</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co">#&gt; 14660 allocations found.</span></span></code></pre></div>
</div>
<div id="generate-shuffling-function-for-potential-study-designs" class="section level2">
<h2>Generate shuffling function for potential study designs</h2>
<p>So far we only know the sizes of subgroups (i.e. cages). Thus, in a
last step we have to assign specific animals to the various subgroups.
Ideally each group of ‘equivalent animals’ (in terms of strain and sex)
is split up into more than one subgroup, so there’s many potential ways
to assign animals to those.</p>
<p>To allow optimization as usual, we want to generate a shuffling
function that produces only valid solutions in terms of our constraints,
so that optimization can iterate efficiently over this solution space.
The function can be generated by calling
<em>shuffle_with_subgroup_formation()</em> with the previously created
subgrouping object and the list of possible treatment allocations.</p>
<p>Every call to this shuffling function will return a permutation index
(of the original samples) that constitutes a valid solution to be
scored.</p>
<p>The permutation function actually also constructs a ‘Cage’ variable
(see parameter <code>subgroup_var_name</code> in the call to
<em>form_homogeneous_subgroups()</em>). To make this parameter available
and join it to the samples in the batch container, use flag
<code>report_grouping_as_attribute</code> in the construction of the
permutation function.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>shuffle_proposal <span class="ot">&lt;-</span> <span class="fu">shuffle_with_subgroup_formation</span>(subg, possible, <span class="at">report_grouping_as_attribute =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="fu">shuffle_proposal</span>()</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co">#&gt; $location_assignment</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">#&gt;  [1]  9 10 13  8 11 12 14 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">#&gt; [26] 59  2  3  4  5 56 57 58  1  6  7 35 36 37 19 20 21 26 27 15 16 17 18 22 23</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">#&gt; [51] 24 25 28 29 30 31 32 33 34</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#&gt; $samples_attr</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#&gt; # A tibble: 59 × 4</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">#&gt;    alloc_var_level group subgroup Cage </span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;           &lt;int&gt;    &lt;int&gt; &lt;chr&gt;</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co">#&gt;  1 Treatment B         7        1 7_1  </span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co">#&gt;  2 Treatment A         7        2 7_2  </span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="co">#&gt;  3 Treatment A         7        2 7_2  </span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a><span class="co">#&gt;  4 Treatment A         7        2 7_2  </span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="co">#&gt;  5 Treatment A         7        2 7_2  </span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a><span class="co">#&gt;  6 Treatment B         7        1 7_1  </span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a><span class="co">#&gt;  7 Treatment B         7        1 7_1  </span></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a><span class="co">#&gt;  8 Treatment A         1        2 1_2  </span></span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a><span class="co">#&gt;  9 Treatment A         1        1 1_1  </span></span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a><span class="co">#&gt; 10 Treatment A         1        1 1_1  </span></span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a><span class="co">#&gt; # ℹ 49 more rows</span></span></code></pre></div>
<p>Calling the shuffle proposal function repeatedly produces a valid
(constraint-aware) sample arrangement each time, with the grouping
variable (here: Cage) reported alongside. (The optimizer will merge the
‘Cage’ variable into the batch container after each iteration, so that
it can be used for scoring as if it would have been in the container
from the beginning!)</p>
</div>
<div id="use-shuffling-function-for-optimizing-design" class="section level2">
<h2>Use shuffling function for optimizing design</h2>
<p>We can finally use the customized shuffling function in the
optimization.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>bc3 <span class="ot">&lt;-</span> <span class="fu">optimize_design</span>(</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  bc,</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>  <span class="at">scoring =</span> scoring_f,</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>  <span class="at">shuffle_proposal_func =</span> shuffle_proposal,</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>  <span class="at">max_iter =</span> <span class="dv">300</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>)</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co">#&gt; Usage of sample attributes --&gt; executing first shuffling call.</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="co">#&gt; Checking variances of 1-dim. score vector.</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co">#&gt; ... (378.225) - OK</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co">#&gt; Initial score: 289.541</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">#&gt; Adding 4 attributes to samples.</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="co">#&gt; Achieved score: 189.066 at iteration 9</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="co">#&gt; Achieved score: 139.439 at iteration 15</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="co">#&gt; Achieved score: 105.405 at iteration 34</span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="co">#&gt; Achieved score: 52.931 at iteration 55</span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a><span class="co">#&gt; Achieved score: 51.304 at iteration 70</span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a><span class="co">#&gt; Achieved score: 32.863 at iteration 206</span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a>design <span class="ot">&lt;-</span> bc3<span class="sc">$</span><span class="fu">get_samples</span>()</span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a><span class="co"># Obeying all constraints does not lead to a very balanced sample allocation:</span></span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">count</span>(design, Treatment, Strain) <span class="sc">|&gt;</span> gt<span class="sc">::</span><span class="fu">gt</span>()</span></code></pre></div>
<div id="cbahqwnfyo" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#cbahqwnfyo table {
font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;
}
#cbahqwnfyo thead, #cbahqwnfyo tbody, #cbahqwnfyo tfoot, #cbahqwnfyo tr, #cbahqwnfyo td, #cbahqwnfyo th {
border-style: none;
}
#cbahqwnfyo p {
margin: 0;
padding: 0;
}
#cbahqwnfyo .gt_table {
display: table;
border-collapse: collapse;
line-height: normal;
margin-left: auto;
margin-right: auto;
color: #333333;
font-size: 16px;
font-weight: normal;
font-style: normal;
background-color: #FFFFFF;
width: auto;
border-top-style: solid;
border-top-width: 2px;
border-top-color: #A8A8A8;
border-right-style: none;
border-right-width: 2px;
border-right-color: #D3D3D3;
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #A8A8A8;
border-left-style: none;
border-left-width: 2px;
border-left-color: #D3D3D3;
}
#cbahqwnfyo .gt_caption {
padding-top: 4px;
padding-bottom: 4px;
}
#cbahqwnfyo .gt_title {
color: #333333;
font-size: 125%;
font-weight: initial;
padding-top: 4px;
padding-bottom: 4px;
padding-left: 5px;
padding-right: 5px;
border-bottom-color: #FFFFFF;
border-bottom-width: 0;
}
#cbahqwnfyo .gt_subtitle {
color: #333333;
font-size: 85%;
font-weight: initial;
padding-top: 3px;
padding-bottom: 5px;
padding-left: 5px;
padding-right: 5px;
border-top-color: #FFFFFF;
border-top-width: 0;
}
#cbahqwnfyo .gt_heading {
background-color: #FFFFFF;
text-align: center;
border-bottom-color: #FFFFFF;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
}
#cbahqwnfyo .gt_bottom_border {
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
}
#cbahqwnfyo .gt_col_headings {
border-top-style: solid;
border-top-width: 2px;
border-top-color: #D3D3D3;
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
}
#cbahqwnfyo .gt_col_heading {
color: #333333;
background-color: #FFFFFF;
font-size: 100%;
font-weight: normal;
text-transform: inherit;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
vertical-align: bottom;
padding-top: 5px;
padding-bottom: 6px;
padding-left: 5px;
padding-right: 5px;
overflow-x: hidden;
}
#cbahqwnfyo .gt_column_spanner_outer {
color: #333333;
background-color: #FFFFFF;
font-size: 100%;
font-weight: normal;
text-transform: inherit;
padding-top: 0;
padding-bottom: 0;
padding-left: 4px;
padding-right: 4px;
}
#cbahqwnfyo .gt_column_spanner_outer:first-child {
padding-left: 0;
}
#cbahqwnfyo .gt_column_spanner_outer:last-child {
padding-right: 0;
}
#cbahqwnfyo .gt_column_spanner {
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
vertical-align: bottom;
padding-top: 5px;
padding-bottom: 5px;
overflow-x: hidden;
display: inline-block;
width: 100%;
}
#cbahqwnfyo .gt_spanner_row {
border-bottom-style: hidden;
}
#cbahqwnfyo .gt_group_heading {
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
color: #333333;
background-color: #FFFFFF;
font-size: 100%;
font-weight: initial;
text-transform: inherit;
border-top-style: solid;
border-top-width: 2px;
border-top-color: #D3D3D3;
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
vertical-align: middle;
text-align: left;
}
#cbahqwnfyo .gt_empty_group_heading {
padding: 0.5px;
color: #333333;
background-color: #FFFFFF;
font-size: 100%;
font-weight: initial;
border-top-style: solid;
border-top-width: 2px;
border-top-color: #D3D3D3;
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
vertical-align: middle;
}
#cbahqwnfyo .gt_from_md > :first-child {
margin-top: 0;
}
#cbahqwnfyo .gt_from_md > :last-child {
margin-bottom: 0;
}
#cbahqwnfyo .gt_row {
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
margin: 10px;
border-top-style: solid;
border-top-width: 1px;
border-top-color: #D3D3D3;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
vertical-align: middle;
overflow-x: hidden;
}
#cbahqwnfyo .gt_stub {
color: #333333;
background-color: #FFFFFF;
font-size: 100%;
font-weight: initial;
text-transform: inherit;
border-right-style: solid;
border-right-width: 2px;
border-right-color: #D3D3D3;
padding-left: 5px;
padding-right: 5px;
}
#cbahqwnfyo .gt_stub_row_group {
color: #333333;
background-color: #FFFFFF;
font-size: 100%;
font-weight: initial;
text-transform: inherit;
border-right-style: solid;
border-right-width: 2px;
border-right-color: #D3D3D3;
padding-left: 5px;
padding-right: 5px;
vertical-align: top;
}
#cbahqwnfyo .gt_row_group_first td {
border-top-width: 2px;
}
#cbahqwnfyo .gt_row_group_first th {
border-top-width: 2px;
}
#cbahqwnfyo .gt_summary_row {
color: #333333;
background-color: #FFFFFF;
text-transform: inherit;
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
}
#cbahqwnfyo .gt_first_summary_row {
border-top-style: solid;
border-top-color: #D3D3D3;
}
#cbahqwnfyo .gt_first_summary_row.thick {
border-top-width: 2px;
}
#cbahqwnfyo .gt_last_summary_row {
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
}
#cbahqwnfyo .gt_grand_summary_row {
color: #333333;
background-color: #FFFFFF;
text-transform: inherit;
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
}
#cbahqwnfyo .gt_first_grand_summary_row {
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
border-top-style: double;
border-top-width: 6px;
border-top-color: #D3D3D3;
}
#cbahqwnfyo .gt_last_grand_summary_row_top {
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
border-bottom-style: double;
border-bottom-width: 6px;
border-bottom-color: #D3D3D3;
}
#cbahqwnfyo .gt_striped {
background-color: rgba(128, 128, 128, 0.05);
}
#cbahqwnfyo .gt_table_body {
border-top-style: solid;
border-top-width: 2px;
border-top-color: #D3D3D3;
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
}
#cbahqwnfyo .gt_footnotes {
color: #333333;
background-color: #FFFFFF;
border-bottom-style: none;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
border-left-style: none;
border-left-width: 2px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 2px;
border-right-color: #D3D3D3;
}
#cbahqwnfyo .gt_footnote {
margin: 0px;
font-size: 90%;
padding-top: 4px;
padding-bottom: 4px;
padding-left: 5px;
padding-right: 5px;
}
#cbahqwnfyo .gt_sourcenotes {
color: #333333;
background-color: #FFFFFF;
border-bottom-style: none;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
border-left-style: none;
border-left-width: 2px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 2px;
border-right-color: #D3D3D3;
}
#cbahqwnfyo .gt_sourcenote {
font-size: 90%;
padding-top: 4px;
padding-bottom: 4px;
padding-left: 5px;
padding-right: 5px;
}
#cbahqwnfyo .gt_left {
text-align: left;
}
#cbahqwnfyo .gt_center {
text-align: center;
}
#cbahqwnfyo .gt_right {
text-align: right;
font-variant-numeric: tabular-nums;
}
#cbahqwnfyo .gt_font_normal {
font-weight: normal;
}
#cbahqwnfyo .gt_font_bold {
font-weight: bold;
}
#cbahqwnfyo .gt_font_italic {
font-style: italic;
}
#cbahqwnfyo .gt_super {
font-size: 65%;
}
#cbahqwnfyo .gt_footnote_marks {
font-size: 75%;
vertical-align: 0.4em;
position: initial;
}
#cbahqwnfyo .gt_asterisk {
font-size: 100%;
vertical-align: 0;
}
#cbahqwnfyo .gt_indent_1 {
text-indent: 5px;
}
#cbahqwnfyo .gt_indent_2 {
text-indent: 10px;
}
#cbahqwnfyo .gt_indent_3 {
text-indent: 15px;
}
#cbahqwnfyo .gt_indent_4 {
text-indent: 20px;
}
#cbahqwnfyo .gt_indent_5 {
text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Treatment">Treatment</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Strain">Strain</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="n">n</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="Treatment" class="gt_row gt_center">Treatment A</td>
<td headers="Strain" class="gt_row gt_left">Strain A</td>
<td headers="n" class="gt_row gt_right">17</td></tr>
    <tr><td headers="Treatment" class="gt_row gt_center">Treatment A</td>
<td headers="Strain" class="gt_row gt_left">Strain B</td>
<td headers="n" class="gt_row gt_right">13</td></tr>
    <tr><td headers="Treatment" class="gt_row gt_center">Treatment B</td>
<td headers="Strain" class="gt_row gt_left">Strain A</td>
<td headers="n" class="gt_row gt_right">12</td></tr>
    <tr><td headers="Treatment" class="gt_row gt_center">Treatment B</td>
<td headers="Strain" class="gt_row gt_left">Strain B</td>
<td headers="n" class="gt_row gt_right">17</td></tr>
  </tbody>
  
  
</table>
</div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">count</span>(design, Treatment, Sex) <span class="sc">|&gt;</span> gt<span class="sc">::</span><span class="fu">gt</span>()</span></code></pre></div>
<div id="wphxcntktc" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#wphxcntktc table {
font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;
}
#wphxcntktc thead, #wphxcntktc tbody, #wphxcntktc tfoot, #wphxcntktc tr, #wphxcntktc td, #wphxcntktc th {
border-style: none;
}
#wphxcntktc p {
margin: 0;
padding: 0;
}
#wphxcntktc .gt_table {
display: table;
border-collapse: collapse;
line-height: normal;
margin-left: auto;
margin-right: auto;
color: #333333;
font-size: 16px;
font-weight: normal;
font-style: normal;
background-color: #FFFFFF;
width: auto;
border-top-style: solid;
border-top-width: 2px;
border-top-color: #A8A8A8;
border-right-style: none;
border-right-width: 2px;
border-right-color: #D3D3D3;
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #A8A8A8;
border-left-style: none;
border-left-width: 2px;
border-left-color: #D3D3D3;
}
#wphxcntktc .gt_caption {
padding-top: 4px;
padding-bottom: 4px;
}
#wphxcntktc .gt_title {
color: #333333;
font-size: 125%;
font-weight: initial;
padding-top: 4px;
padding-bottom: 4px;
padding-left: 5px;
padding-right: 5px;
border-bottom-color: #FFFFFF;
border-bottom-width: 0;
}
#wphxcntktc .gt_subtitle {
color: #333333;
font-size: 85%;
font-weight: initial;
padding-top: 3px;
padding-bottom: 5px;
padding-left: 5px;
padding-right: 5px;
border-top-color: #FFFFFF;
border-top-width: 0;
}
#wphxcntktc .gt_heading {
background-color: #FFFFFF;
text-align: center;
border-bottom-color: #FFFFFF;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
}
#wphxcntktc .gt_bottom_border {
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
}
#wphxcntktc .gt_col_headings {
border-top-style: solid;
border-top-width: 2px;
border-top-color: #D3D3D3;
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
}
#wphxcntktc .gt_col_heading {
color: #333333;
background-color: #FFFFFF;
font-size: 100%;
font-weight: normal;
text-transform: inherit;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
vertical-align: bottom;
padding-top: 5px;
padding-bottom: 6px;
padding-left: 5px;
padding-right: 5px;
overflow-x: hidden;
}
#wphxcntktc .gt_column_spanner_outer {
color: #333333;
background-color: #FFFFFF;
font-size: 100%;
font-weight: normal;
text-transform: inherit;
padding-top: 0;
padding-bottom: 0;
padding-left: 4px;
padding-right: 4px;
}
#wphxcntktc .gt_column_spanner_outer:first-child {
padding-left: 0;
}
#wphxcntktc .gt_column_spanner_outer:last-child {
padding-right: 0;
}
#wphxcntktc .gt_column_spanner {
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
vertical-align: bottom;
padding-top: 5px;
padding-bottom: 5px;
overflow-x: hidden;
display: inline-block;
width: 100%;
}
#wphxcntktc .gt_spanner_row {
border-bottom-style: hidden;
}
#wphxcntktc .gt_group_heading {
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
color: #333333;
background-color: #FFFFFF;
font-size: 100%;
font-weight: initial;
text-transform: inherit;
border-top-style: solid;
border-top-width: 2px;
border-top-color: #D3D3D3;
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
vertical-align: middle;
text-align: left;
}
#wphxcntktc .gt_empty_group_heading {
padding: 0.5px;
color: #333333;
background-color: #FFFFFF;
font-size: 100%;
font-weight: initial;
border-top-style: solid;
border-top-width: 2px;
border-top-color: #D3D3D3;
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
vertical-align: middle;
}
#wphxcntktc .gt_from_md > :first-child {
margin-top: 0;
}
#wphxcntktc .gt_from_md > :last-child {
margin-bottom: 0;
}
#wphxcntktc .gt_row {
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
margin: 10px;
border-top-style: solid;
border-top-width: 1px;
border-top-color: #D3D3D3;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
vertical-align: middle;
overflow-x: hidden;
}
#wphxcntktc .gt_stub {
color: #333333;
background-color: #FFFFFF;
font-size: 100%;
font-weight: initial;
text-transform: inherit;
border-right-style: solid;
border-right-width: 2px;
border-right-color: #D3D3D3;
padding-left: 5px;
padding-right: 5px;
}
#wphxcntktc .gt_stub_row_group {
color: #333333;
background-color: #FFFFFF;
font-size: 100%;
font-weight: initial;
text-transform: inherit;
border-right-style: solid;
border-right-width: 2px;
border-right-color: #D3D3D3;
padding-left: 5px;
padding-right: 5px;
vertical-align: top;
}
#wphxcntktc .gt_row_group_first td {
border-top-width: 2px;
}
#wphxcntktc .gt_row_group_first th {
border-top-width: 2px;
}
#wphxcntktc .gt_summary_row {
color: #333333;
background-color: #FFFFFF;
text-transform: inherit;
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
}
#wphxcntktc .gt_first_summary_row {
border-top-style: solid;
border-top-color: #D3D3D3;
}
#wphxcntktc .gt_first_summary_row.thick {
border-top-width: 2px;
}
#wphxcntktc .gt_last_summary_row {
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
}
#wphxcntktc .gt_grand_summary_row {
color: #333333;
background-color: #FFFFFF;
text-transform: inherit;
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
}
#wphxcntktc .gt_first_grand_summary_row {
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
border-top-style: double;
border-top-width: 6px;
border-top-color: #D3D3D3;
}
#wphxcntktc .gt_last_grand_summary_row_top {
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
border-bottom-style: double;
border-bottom-width: 6px;
border-bottom-color: #D3D3D3;
}
#wphxcntktc .gt_striped {
background-color: rgba(128, 128, 128, 0.05);
}
#wphxcntktc .gt_table_body {
border-top-style: solid;
border-top-width: 2px;
border-top-color: #D3D3D3;
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
}
#wphxcntktc .gt_footnotes {
color: #333333;
background-color: #FFFFFF;
border-bottom-style: none;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
border-left-style: none;
border-left-width: 2px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 2px;
border-right-color: #D3D3D3;
}
#wphxcntktc .gt_footnote {
margin: 0px;
font-size: 90%;
padding-top: 4px;
padding-bottom: 4px;
padding-left: 5px;
padding-right: 5px;
}
#wphxcntktc .gt_sourcenotes {
color: #333333;
background-color: #FFFFFF;
border-bottom-style: none;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
border-left-style: none;
border-left-width: 2px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 2px;
border-right-color: #D3D3D3;
}
#wphxcntktc .gt_sourcenote {
font-size: 90%;
padding-top: 4px;
padding-bottom: 4px;
padding-left: 5px;
padding-right: 5px;
}
#wphxcntktc .gt_left {
text-align: left;
}
#wphxcntktc .gt_center {
text-align: center;
}
#wphxcntktc .gt_right {
text-align: right;
font-variant-numeric: tabular-nums;
}
#wphxcntktc .gt_font_normal {
font-weight: normal;
}
#wphxcntktc .gt_font_bold {
font-weight: bold;
}
#wphxcntktc .gt_font_italic {
font-style: italic;
}
#wphxcntktc .gt_super {
font-size: 65%;
}
#wphxcntktc .gt_footnote_marks {
font-size: 75%;
vertical-align: 0.4em;
position: initial;
}
#wphxcntktc .gt_asterisk {
font-size: 100%;
vertical-align: 0;
}
#wphxcntktc .gt_indent_1 {
text-indent: 5px;
}
#wphxcntktc .gt_indent_2 {
text-indent: 10px;
}
#wphxcntktc .gt_indent_3 {
text-indent: 15px;
}
#wphxcntktc .gt_indent_4 {
text-indent: 20px;
}
#wphxcntktc .gt_indent_5 {
text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Treatment">Treatment</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Sex">Sex</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="n">n</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="Treatment" class="gt_row gt_center">Treatment A</td>
<td headers="Sex" class="gt_row gt_left">F</td>
<td headers="n" class="gt_row gt_right">10</td></tr>
    <tr><td headers="Treatment" class="gt_row gt_center">Treatment A</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="n" class="gt_row gt_right">20</td></tr>
    <tr><td headers="Treatment" class="gt_row gt_center">Treatment B</td>
<td headers="Sex" class="gt_row gt_left">F</td>
<td headers="n" class="gt_row gt_right">4</td></tr>
    <tr><td headers="Treatment" class="gt_row gt_center">Treatment B</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="n" class="gt_row gt_right">25</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
